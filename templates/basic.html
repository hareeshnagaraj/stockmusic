<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <!-- Style -->
  <link rel="stylesheet" href="/static/css/nv.d3.css" type="text/css">
  <style>
  body {
    overflow-y:scroll;
  }
  text {
    font: 12px sans-serif;
  }
  svg {
    display: block;
  }
  #chart1 svg {
    height: 500px;
    min-width: 200px;
    min-height: 100px;
  /*
    margin: 50px;
    Minimum height and width is a good idea to prevent negative SVG dimensions...
    For example width should be =< margin.left + margin.right + 1,
    of course 1 pixel for the entire chart would not be very useful, BUT should not have errors
  */
  }
  #chart1 {
    margin-top: 0px;
    margin-left: 10px;
  }
  .tempButton{
    width:100px;
    height:50px;
    background-color: red;
  }
  </style>
  <!-- D3 Charts include -->
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <!-- jQuery -->
  <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
  <!-- Data -->
  <script src="/static/js/require.js" charset="utf-8"></script>
  <!-- Line Graph, nvd3-->
  <script src="/static/js/line-graph.js" charset="utf-8"></script>
  <script src="/static/js/dataParser.js" charset="utf-8"></script>
  <script src="/static/js/nvd3/nv.d3.js" charset="utf-8"></script>
  <script src="/static/js/nvd3/tooltip.js"></script>
  <script src="/static/js/nvd3/utils.js"></script>
  <script src="/static/js/nvd3/interactiveLayer.js"></script>
  <script src="/static/js/nvd3/models/legend.js"></script>
  <script src="/static/js/nvd3/models/axis.js"></script>
  <script src="/static/js/nvd3/models/scatter.js"></script>
  <script src="/static/js/nvd3/models/line.js"></script>
  <script src="/static/js/nvd3/models/lineChart.js"></script>
  <!-- Vexflow, Music notation library -->
  <script src="/static/js/vexflow/vexflow.min.js"></script>
  <!-- MIDI JS -->
  <script src="/static/js/MIDIJS/AudioDetect.js"></script>
  <script src="/static/js/MIDIJS/DOMLoader.script.js"></script>
  <script src="/static/js/MIDIJS/DOMLoader.XMLHttp.js"></script>
  <script src="/static/js/MIDIJS/LoadPlugin.js"></script>
  <script src="/static/js/MIDIJS/Player.js"></script>
  <script src="/static/js/MIDIJS/Plugin.js"></script>
  <script src="/static/js/MIDIJS/Base64.js"></script>
  <script src="/static/js/MIDIJS/base64binary.js"></script>
  
  <!-- Chart Creation  -->
  <script src="/static/js/chartCreator.js"></script>
  
  <script>
    /*
    Creating a global notes object to be accessed and updated independently by Vexflow and audiosynth.js
    */
    var notes = [
      {
        "note":"C",
        "octave":4,
        "duration_vex":"q",
        "duration_audio":2
      },
      {
        "note":"D",
        "octave":4,
        "duration_vex":"q",
        "duration_audio":2
      },
      {
        "note":"E",
        "octave":4,
        "duration_vex":"q",
        "duration_audio":2
      },
      {
        "note":"B",
        "octave":4,
        "duration_vex":"qr",
        "duration_audio":2
      },
    ];
    //adding the midi player onload
    $(window).load(function(){
      MIDI.loadPlugin({
        soundfontUrl: "/static/js/MIDIJS/soundfont/",
        instruments: [ "acoustic_grand_piano"],
        callback: function() {
          playNotes(); 
        }
      });
      $.ajax({
        url:'/query',
        data:{ticker:'EBAY',start_date:'2013-11-25',end_date:'2014-5-31'},
        success:function(data){
          console.log(data)
          chartCreator(data,nv);
        },
        dataType:'json'
      });
    });

    /*
    Function to play files from external MIDI file  
    */
    function playNotes(){
      MIDI.programChange(0, 0);
      MIDI.programChange(1, 118);
      for (var n = 0; n < 100; n ++) {
        var delay = n / 4; // play one note every quarter second
        var note = MIDI.pianoKeyOffset + n; // the MIDI note
        var velocity = 127; // how hard the note hits
        // play the note
        MIDI.noteOn(0, note, velocity, delay);
        // play the some note 3-steps up
        MIDI.noteOn(1, note + 3, velocity, delay);
      }
    }
  </script>
</head>
<body >
  <!-- Data Parser Object -->
<div id="chart1" >
  <svg style="height: 500px;"></svg>
</div>
<div class="one">
  <div class="a">
    <canvas id="canvas" width="700" height="100"></canvas>
  </div>
</div>
<script> //vexflow script for display of musical stuff
  var canvas = $(".one .a canvas")[0];
  var renderer = new Vex.Flow.Renderer(canvas,
    Vex.Flow.Renderer.Backends.CANVAS);

  var ctx = renderer.getContext();
  var stave = new Vex.Flow.Stave(10, 0, 500);
  stave.addClef("treble").setContext(ctx).draw();
  // Create the notes
  var vexNotes = [
    // A quarter-note C.
    new Vex.Flow.StaveNote({ keys: ["C/4"], duration: "q" }),
    // A quarter-note D.
    new Vex.Flow.StaveNote({ keys: ["D/4"], duration: "q" }),
    // A quarter-note rest. Note that the key (b/4) specifies the vertical
    // position of the rest.
    new Vex.Flow.StaveNote({ keys: ["B/4"], duration: "qr" }),
    // A C-Major chord.
    new Vex.Flow.StaveNote({ keys: [ "E/4", "g/4"], duration: "q" })
  ];
  // Create a voice in 4/4
  var voice = new Vex.Flow.Voice({
    num_beats: 4,
    beat_value: 4,
    resolution: Vex.Flow.RESOLUTION
  });

  // Add notes to voice
  voice.addTickables(vexNotes);

  // Format and justify the notes to 500 pixels
  var formatter = new Vex.Flow.Formatter().
    joinVoices([voice]).format([voice], 500);

  // Render voice
  voice.draw(ctx, stave);
</script>
<div class="tempButton"></div>
</body>
</html>